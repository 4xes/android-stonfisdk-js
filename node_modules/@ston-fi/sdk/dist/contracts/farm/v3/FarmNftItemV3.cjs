"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const w=require("tonweb"),y=require("../../../StonApiClient.cjs"),g=require("../../../utils/createSbtDestroyMessage.cjs"),C=require("../../../utils/parseAddress.cjs"),A=require("../../../utils/parseDictionary/index.cjs"),a=require("../constants.cjs"),m=require("./FarmNftMinterV3.cjs"),{boc:{Cell:c},utils:{BN:r,Address:i},token:{nft:{NftItem:h}}}=w,d=class u extends h{constructor({tonApiClient:t,stonApiClient:e,gasConstants:s,...n}){super(t,n),this.stonApiClient=e??new y.StonApiClient(t),this.gasConstants={...u.gasConstants,...s}}async createClaimRewardsBody(t){const e=new c;return e.bits.writeUint(a.FARM_OP_CODES.CLAIM_REWARDS,32),e.bits.writeUint(t.queryId??0,64),t.claimAll?(e.bits.writeUint(1,1),e.bits.writeUint(0,8)):(e.bits.writeUint(0,1),e.bits.writeUint(t.poolIndex,8)),e}async buildClaimRewardsTxParams(t){const e=await this.getAddress(),s=await this.createClaimRewardsBody({queryId:t.queryId,claimAll:t.poolIndex===void 0,poolIndex:t.poolIndex??0}),n=t.poolCount??await this.getPoolCount(),o=this.gasConstants.claimRewardsBase.add(this.gasConstants.claimRewardsPerPool.muln(n-1));return{to:new i(e.toString(!0,!0,!0)),payload:s,gasAmount:o}}async createUnstakeBody(t){const e=new c;return e.bits.writeUint(a.FARM_OP_CODES.UNSTAKE,32),e.bits.writeUint((t==null?void 0:t.queryId)??0,64),e}async buildUnstakeTxParams(t){const e=await this.getAddress(),s=await this.createUnstakeBody({queryId:t.queryId}),n=t.poolCount??await this.getPoolCount(),o=this.gasConstants.unstakeBase.add(this.gasConstants.unstakePerPool.muln(n-1));return{to:new i(e.toString(!0,!0,!0)),payload:s,gasAmount:o}}async createDestroyBody(t){return g.createSbtDestroyMessage({queryId:(t==null?void 0:t.queryId)??0})}async buildDestroyTxParams(t){const e=await this.getAddress(),s=await this.createDestroyBody({queryId:t==null?void 0:t.queryId}),n=this.gasConstants.destroy;return{to:new i(e.toString(!0,!0,!0)),payload:s,gasAmount:n}}async getFarmingData(){const t=await this.getAddress(),e=await this.provider.call2(t.toString(),"get_farming_data"),s=A.parseDictionaryUint(e[4],8,150),n=new Map;return s.forEach((o,l)=>{n.set(Number(l),o)}),{status:e[0].toNumber(),revokeTime:e[1],stakedTokens:e[2],stakeDate:e[3],claimedPerUnit:n,ownerAddress:C.parseAddressNotNull(e[5])}}async getPoolCount(){const{collectionAddress:t}=await this.getData(),e=new m.FarmNftMinterV3({tonApiClient:this.provider,stonApiClient:this.stonApiClient,address:t}),{poolCount:s}=await e.getData();return s}};d.version=a.FARM_VERSION.v3;d.gasConstants={claimRewardsBase:new r("350000000"),claimRewardsPerPool:new r("130000000"),unstakeBase:new r("450000000"),unstakePerPool:new r("130000000"),destroy:new r("50000000")};let I=d;exports.FarmNftItemV3=I;
//# sourceMappingURL=FarmNftItemV3.cjs.map
